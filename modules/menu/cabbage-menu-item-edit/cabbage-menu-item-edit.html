<link rel="import" href="../../../bower_components/polymer/polymer.html">

<polymer-element name="cabbage-menu-item-edit" attributes="menuId">
	<template>

		<core-ajax  id="getRepos"
					url="http://127.0.0.1:3000/api/menu"
					menthod="GET",
					handleAs="json"
					params="{{ {id: menuId} }}"
					on-core-response="{{ onMenuInfoReceived }}"
					on-core-error="{{ onMenuInfoError }}"></core-ajax>

		<core-ajax  id="updateMenu"
					url="http://127.0.0.1:3000/api/menu/{{ menuId }}"
					method="PUT"
					handleAs="text"
					contentType="application/json"
					on-core-response="{{ onMenuItemUpdateResponse }}"
					on-core-error="{{ onMenuItemUpdateError }}"></core-ajax>

		<div id="wrapper">
			<paper-input id="name" label="Name"></paper-input>
			<paper-input id="price" label="Price"></paper-input>
			<paper-input id="image" label="Image URL"></paper-input>
			<paper-input id="description" label="Description"></paper-input>

			<div id="fab-wrapper" horizontal end-justified layout>
				<paper-fab icon="clear" on-click="{{ onUpdateButtonClick }}" style="background-color: red;"></paper-fab>
				<paper-fab icon="done" on-click="{{ onUpdateButtonClick }}" style="background-color: green;"></paper-fab>
			</div>
		</div>

		<style>
			#wrapper {
				background-color: #eee;
				margin: 50px auto 20px auto;
				width: 70%;
				font-size: 18px;
				font-weight: 200;
				line-height: 30px;
				background-color: #eee;
				border-radius: 6px;
				padding: 30px;
				padding-bottom: 80px;
				position: relative;
			}
			#fab-wrapper {
				position: absolute;
				bottom: 0px; right: 0px;
				margin-bottom: 10px;
				margin-right: 10px;
			}
			paper-fab { 
				margin-right: 10px;
			}
			paper-input   { display: block; }
		</style>
	</template>

	<script>
		(function() {
			Polymer({
				getData: function() {
					return {
						'name': this.$.name.value,
						'description': this.$.description.value,
						'image': this.$.image.value,
						'price': this.$.price.value
					};
				},
				refresh: function(){
					console.log('refresh');
				},
				menuIdChanged: function() {
					this.getMenuInfo();
				},
				getMenuInfo: function() {
					this.$.getRepos.go();
				},
				onUpdateButtonClick: function() {
					this.$.updateMenu.body = JSON.stringify(this.getData());
					this.$.updateMenu.go();
				},
				onMenuItemUpdateResponse: function() {
					MoreRouting.navigateTo('menu-info', {id: this.menuId});					
				},
				onMenuItemUpdateError: function() {
				},
				onMenuInfoReceived: function(data) {
					var menuData = data.detail.response;
					this.$.name.value = menuData.name;
					this.$.description.value = menuData.description;
					this.$.image.value = menuData.image;
					this.$.price.value = menuData.price;
				},
				onMenuInfoError: function(error) {
				}

			});
		})();
	</script>
</polymer-element>
